import{H as N,j as Y,t as P,R as C,e as Z,A as ee}from"./chunks/index.js";import*as D from"devalue";import{w as ie,r as Xe}from"./chunks/index2.js";import{a as G,b as F,p as ce,v as Ke,o as Qe,g as Ye,s as Ze}from"./chunks/internal.js";import{parse as V,serialize as xe}from"cookie";import*as ue from"set-cookie-parser";const le=!1;function te(e,t){const r=[];e.split(",").forEach((o,a)=>{const i=/([^/]+)\/([^;]+)(?:;q=([0-9.]+))?/.exec(o);if(i){const[,c,p,l="1"]=i;r.push({type:c,subtype:p,q:+l,i:a})}}),r.sort((o,a)=>o.q!==a.q?a.q-o.q:o.subtype==="*"!=(a.subtype==="*")?o.subtype==="*"?1:-1:o.type==="*"!=(a.type==="*")?o.type==="*"?1:-1:o.i-a.i);let n,s=1/0;for(const o of t){const[a,i]=o.split("/"),c=r.findIndex(p=>(p.type===a||p.type==="*")&&(p.subtype===i||p.subtype==="*"));c!==-1&&c<s&&(n=o,s=c)}return n}function et(e,...t){const r=e.headers.get("content-type")?.split(";",1)[0].trim()??"";return t.includes(r)}function Re(e){return et(e,"application/x-www-form-urlencoded","multipart/form-data")}function tt(e){return e instanceof Error||e&&e.name&&e.message?e:new Error(JSON.stringify(e))}const ve={id:"__error"};function rt(e,t){return P(`${t} method not allowed`,{status:405,headers:{allow:nt(e).join(", ")}})}function nt(e){const t=[];for(const r in["GET","POST","PUT","PATCH","DELETE","OPTIONS"])r in e&&t.push(r);return(e.GET||e.HEAD)&&t.push("HEAD"),t}function re(e,t,r){return P(e.templates.error({status:t,message:r}),{headers:{"content-type":"text/html; charset=utf-8"},status:t})}async function de(e,t,r){r=r instanceof N?r:tt(r);const n=r instanceof N?r.status:500,s=await H(e,t,r),o=te(e.request.headers.get("accept")||"text/html",["application/json","text/html"]);return e.isDataRequest||o==="application/json"?Y(s,{status:n}):re(t,n,s.message)}async function H(e,t,r){return r instanceof N?r.body:await t.hooks.handleError({error:r,event:e})??{message:e.route.id!=null?"Internal Error":"Not Found"}}function B(e,t){return new Response(void 0,{status:e,headers:{location:t}})}function Se(e,t){return t.path?`Data returned from \`load\` while rendering ${e.route.id} is not serializable: ${t.message} (data${t.path})`:t.path===""?`Data returned from \`load\` while rendering ${e.route.id} is not a plain object`:t.message}function Oe(e){if(!e)return"null";if(e.type==="error"||e.type==="skip")return JSON.stringify(e);const t=D.stringify(e.data),r=[];return e.uses.dependencies.size>0&&r.push(`"dependencies":${JSON.stringify(Array.from(e.uses.dependencies))}`),e.uses.params.size>0&&r.push(`"params":${JSON.stringify(Array.from(e.uses.params))}`),e.uses.parent&&r.push('"parent":1'),e.uses.route&&r.push('"route":1'),e.uses.url&&r.push('"url":1'),`{"type":"data","data":${t},"uses":{${r.join(",")}}${e.slash?`,"slash":${JSON.stringify(e.slash)}`:""}}`}async function st(e,t,r,n){const s=e.request.method;let o=r[s];if(!o&&s==="HEAD"&&(o=r.GET),!o)return rt(r,s);const a=r.prerender??n.prerender_default;if(a&&(r.POST||r.PATCH||r.PUT||r.DELETE))throw new Error("Cannot prerender endpoints that have mutative methods");if(n.prerendering&&!a){if(n.initiator)throw new Error(`${e.route.id} is not prerenderable`);return new Response(void 0,{status:204})}n.initiator=t;try{const i=await o(e);if(!(i instanceof Response))throw new Error(`Invalid response from route ${e.url.pathname}: handler should return a Response object`);return n.prerendering&&i.headers.set("x-sveltekit-prerender",String(a)),i}catch(i){if(i instanceof C)return new Response(void 0,{status:i.status,headers:{location:i.location}});throw i}}function ot(e){const{method:t,headers:r}=e.request;if(t==="PUT"||t==="PATCH"||t==="DELETE"||t==="OPTIONS")return!0;if(t==="POST"&&r.get("x-sveltekit-action")==="true")return!1;const n=e.request.headers.get("accept")??"*/*";return te(n,["*","text/html"])!=="text/html"}function fe(e){return e.filter(t=>t!=null)}function ne(e,t){return e==="/"||t==="ignore"?e:t==="never"?e.endsWith("/")?e.slice(0,-1):e:t==="always"&&!e.endsWith("/")?e+"/":e}function at(e){return e.split("%25").map(decodeURI).join("%25")}function it(e){for(const t in e)e[t]=decodeURIComponent(e[t]);return e}const ct=["href","pathname","search","searchParams","toString","toJSON"];function ut(e,t){const r=new URL(e);for(const n of ct){let s=r[n];Object.defineProperty(r,n,{get(){return t(),s},enumerable:!0,configurable:!0})}return r[Symbol.for("nodejs.util.inspect.custom")]=(n,s,o)=>o(e,s),lt(r),r}function lt(e){Object.defineProperty(e,"hash",{get(){throw new Error("Cannot access event.url.hash. Consider using `$page.url.hash` inside a component instead")}})}function qe(e){for(const t of["search","searchParams"])Object.defineProperty(e,t,{get(){throw new Error(`Cannot access url.${t} on a page with prerendering enabled`)}})}const se="/__data.json";function dt(e){return e.endsWith(se)}function ft(e){return e.replace(/\/$/,"")+se}function pe(e){return e.slice(0,-se.length)}function pt(e){return te(e.request.headers.get("accept")??"*/*",["application/json","text/html"])==="application/json"&&e.request.method==="POST"}async function ht(e,t,r){const n=r?.actions;if(!n){const s=Z(405,"POST method not allowed. No actions exist for this page");return L({type:"error",error:await H(e,t,s)},{status:s.status,headers:{allow:"GET"}})}Ae(n);try{const s=await Te(e,n);return s instanceof ee?L({type:"failure",status:s.status,data:he(s.data,e.route.id)}):L({type:"success",status:s?200:204,data:he(s,e.route.id)})}catch(s){const o=s;return o instanceof C?L({type:"redirect",status:o.status,location:o.location}):L({type:"error",error:await H(e,t,Pe(o))},{status:o instanceof N?o.status:500})}}function Pe(e){return e instanceof ee?new Error('Cannot "throw fail()". Use "return fail()"'):e}function L(e,t){return Y(e,t)}function _t(e){return e.request.method==="POST"}async function mt(e,t){const r=t?.actions;if(!r)return e.setHeaders({allow:"GET"}),{type:"error",error:Z(405,"POST method not allowed. No actions exist for this page")};Ae(r);try{const n=await Te(e,r);return n instanceof ee?{type:"failure",status:n.status,data:n.data}:{type:"success",status:200,data:n}}catch(n){const s=n;return s instanceof C?{type:"redirect",status:s.status,location:s.location}:{type:"error",error:Pe(s)}}}function Ae(e){if(e.default&&Object.keys(e).length>1)throw new Error("When using named actions, the default action cannot be used. See the docs for more info: https://kit.svelte.dev/docs/form-actions#named-actions")}async function Te(e,t){const r=new URL(e.request.url);let n="default";for(const o of r.searchParams)if(o[0].startsWith("/")){if(n=o[0].slice(1),n==="default")throw new Error('Cannot use reserved action name "default"');break}const s=t[n];if(!s)throw new Error(`No action with name '${n}' found`);if(!Re(e.request))throw new Error(`Actions expect form-encoded data (received ${e.request.headers.get("content-type")}`);return s(e)}function yt(e,t){return Ce(e,D.uneval,t)}function he(e,t){return Ce(e,D.stringify,t)}function Ce(e,t,r){try{return t(e)}catch(n){const s=n;if("path"in s){let o=`Data returned from action inside ${r} is not serializable: ${s.message}`;throw s.path!==""&&(o+=` (data.${s.path})`),new Error(o)}throw s}}async function ze(e){for(const t in e)if(typeof e[t]?.then=="function")return Object.fromEntries(await Promise.all(Object.entries(e).map(async([r,n])=>[r,await n])));return e}async function oe({event:e,state:t,node:r,parent:n}){if(!r?.server)return null;const s={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1},o=ut(e.url,()=>{s.url=!0});t.prerendering&&qe(o);const a=await r.server.load?.call(null,{...e,fetch:(c,p)=>{const l=new URL(c instanceof Request?c.url:c,e.url);return s.dependencies.add(l.href),e.fetch(c,p)},depends:(...c)=>{for(const p of c){const{href:l}=new URL(p,e.url);s.dependencies.add(l)}},params:new Proxy(e.params,{get:(c,p)=>(s.params.add(p),c[p])}),parent:async()=>(s.parent=!0,n()),route:{get id(){return s.route=!0,e.route.id}},url:o});return{type:"data",data:a?await ze(a):null,uses:s,slash:r.server.trailingSlash}}async function Ue({event:e,fetched:t,node:r,parent:n,server_data_promise:s,state:o,resolve_opts:a,csr:i}){const c=await s;if(!r?.universal?.load)return c?.data??null;const p=await r.universal.load.call(null,{url:e.url,params:e.params,data:c?.data??null,route:e.route,fetch:gt(e,o,t,i,a),setHeaders:e.setHeaders,depends:()=>{},parent:n}),l=p?await ze(p):null;return $t(l,e.route.id),l}function gt(e,t,r,n,s){return async(o,a)=>{const i=o instanceof Request&&o.body?o.clone().body:null;let c=await e.fetch(o,a);const p=new URL(o instanceof Request?o.url:o,e.url),l=p.origin===e.url.origin;let _;if(l)t.prerendering&&(_={response:c,body:null},t.prerendering.dependencies.set(p.pathname,_));else if((o instanceof Request?o.mode:a?.mode??"cors")==="no-cors")c=new Response("",{status:c.status,statusText:c.statusText,headers:c.headers});else{const m=c.headers.get("access-control-allow-origin");if(!m||m!==e.url.origin&&m!=="*")throw new Error(`CORS error: ${m?"Incorrect":"No"} 'Access-Control-Allow-Origin' header is present on the requested resource`)}const b=new Proxy(c,{get(u,m,g){async function f(){const d=await u.text();if(!d||typeof d=="string"){const w=Number(u.status);if(isNaN(w))throw new Error(`response.status is not a number. value: "${u.status}" type: ${typeof u.status}`);r.push({url:l?p.href.slice(e.url.origin.length):p.href,method:e.request.method,request_body:o instanceof Request&&i?await wt(i):a?.body,request_headers:a?.headers,response_body:d,response:u})}return _&&(_.body=d),d}return m==="arrayBuffer"?async()=>{const d=await u.arrayBuffer();return _&&(_.body=new Uint8Array(d)),d}:m==="text"?f:m==="json"?async()=>JSON.parse(await f()):Reflect.get(u,m,u)}});if(n){const u=c.headers.get;c.headers.get=m=>{const g=m.toLowerCase(),f=u.call(c.headers,g);if(f&&!g.startsWith("x-sveltekit-")&&!s.filterSerializedResponseHeaders(g,f))throw new Error(`Failed to get response header "${g}" â€” it must be included by the \`filterSerializedResponseHeaders\` option: https://kit.svelte.dev/docs/hooks#server-hooks-handle (at ${e.route.id})`);return f}}return b}}async function wt(e){let t="";const r=e.getReader(),n=new TextDecoder;for(;;){const{done:s,value:o}=await r.read();if(s)break;t+=n.decode(o)}return t}function $t(e,t){if(e!=null&&Object.getPrototypeOf(e)!==Object.prototype)throw new Error(`a load function related to route '${t}' returned ${typeof e!="object"?`a ${typeof e}`:e instanceof Response?"a Response object":Array.isArray(e)?"an array":"a non-plain object"}, but must return a plain object at the top level (i.e. \`return {...}\`)`)}function X(...e){let t=5381;for(const r of e)if(typeof r=="string"){let n=r.length;for(;n;)t=t*33^r.charCodeAt(--n)}else if(ArrayBuffer.isView(r)){const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);let s=n.length;for(;s;)t=t*33^n[--s]}else throw new TypeError("value must be a string or TypedArray");return(t>>>0).toString(36)}const Ne={"&":"&amp;",'"':"&quot;"},bt=new RegExp(`[${Object.keys(Ne).join("")}]|[\\ud800-\\udbff](?![\\udc00-\\udfff])|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\udc00-\\udfff]`,"g");function He(e){return`"${e.replace(bt,r=>r.length===2?r:Ne[r]??`&#${r.charCodeAt(0)};`)}"`}const Ie={"<":"\\u003C","\u2028":"\\u2028","\u2029":"\\u2029"},kt=new RegExp(`[${Object.keys(Ie).join("")}]`,"g");function jt(e,t,r=!1){const n={};let s=null,o=null,a=!1;for(const[l,_]of e.response.headers)t(l,_)&&(n[l]=_),l==="cache-control"&&(s=_),l==="age"&&(o=_),l==="vary"&&(a=!0);const i={status:e.response.status,statusText:e.response.statusText,headers:n,body:e.response_body},c=JSON.stringify(i).replace(kt,l=>Ie[l]),p=['type="application/json"',"data-sveltekit-fetched",`data-url=${He(e.url)}`];if(e.request_headers||e.request_body){const l=[];e.request_headers&&l.push([...new Headers(e.request_headers)].join(",")),e.request_body&&l.push(e.request_body),p.push(`data-hash="${X(...l)}"`)}if(!r&&e.method==="GET"&&s&&!a){const l=/s-maxage=(\d+)/g.exec(s)??/max-age=(\d+)/g.exec(s);if(l){const _=+l[1]-+(o??"0");p.push(`data-ttl="${_}"`)}}return`<script ${p.join(" ")}>${c}<\/script>`}const A=JSON.stringify,Et=new TextEncoder;function _e(e){K[0]||xt();const t=We.slice(0),r=Rt(e);for(let s=0;s<r.length;s+=16){const o=r.subarray(s,s+16);let a,i,c,p=t[0],l=t[1],_=t[2],b=t[3],u=t[4],m=t[5],g=t[6],f=t[7];for(let d=0;d<64;d++)d<16?a=o[d]:(i=o[d+1&15],c=o[d+14&15],a=o[d&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+o[d&15]+o[d+9&15]|0),a=a+f+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(g^u&(m^g))+K[d],f=g,g=m,m=u,u=b+a|0,b=_,_=l,l=p,p=a+(l&_^b&(l^_))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;t[0]=t[0]+p|0,t[1]=t[1]+l|0,t[2]=t[2]+_|0,t[3]=t[3]+b|0,t[4]=t[4]+u|0,t[5]=t[5]+m|0,t[6]=t[6]+g|0,t[7]=t[7]+f|0}const n=new Uint8Array(t.buffer);return De(n),Le(n)}const We=new Uint32Array(8),K=new Uint32Array(64);function xt(){function e(r){return(r-Math.floor(r))*4294967296}let t=2;for(let r=0;r<64;t++){let n=!0;for(let s=2;s*s<=t;s++)if(t%s===0){n=!1;break}n&&(r<8&&(We[r]=e(t**(1/2))),K[r]=e(t**(1/3)),r++)}}function De(e){for(let t=0;t<e.length;t+=4){const r=e[t+0],n=e[t+1],s=e[t+2],o=e[t+3];e[t+0]=o,e[t+1]=s,e[t+2]=n,e[t+3]=r}}function Rt(e){const t=Et.encode(e),r=t.length*8,n=512*Math.ceil((r+65)/512),s=new Uint8Array(n/8);s.set(t),s[t.length]=128,De(s);const o=new Uint32Array(s.buffer);return o[o.length-2]=Math.floor(r/4294967296),o[o.length-1]=r,o}const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");function Le(e){const t=e.length;let r="",n;for(n=2;n<t;n+=3)r+=T[e[n-2]>>2],r+=T[(e[n-2]&3)<<4|e[n-1]>>4],r+=T[(e[n-1]&15)<<2|e[n]>>6],r+=T[e[n]&63];return n===t+1&&(r+=T[e[n-2]>>2],r+=T[(e[n-2]&3)<<4],r+="=="),n===t&&(r+=T[e[n-2]>>2],r+=T[(e[n-2]&3)<<4|e[n-1]>>4],r+=T[(e[n-1]&15)<<2],r+="="),r}const me=new Uint8Array(16);function vt(){return crypto.getRandomValues(me),Le(me)}const St=new Set(["self","unsafe-eval","unsafe-hashes","unsafe-inline","none","strict-dynamic","report-sample","wasm-unsafe-eval","script"]),Ot=/^(nonce|sha\d\d\d)-/;class Je{#e;#t;#s;#o;#r;#n;#a;constructor(t,r,n){this.#e=t,this.#o=r;const s=this.#o;this.#r=[],this.#n=[];const o=s["script-src"]||s["default-src"],a=s["style-src"]||s["default-src"];this.#t=!!o&&o.filter(i=>i!=="unsafe-inline").length>0,this.#s=!!a&&a.filter(i=>i!=="unsafe-inline").length>0,this.script_needs_nonce=this.#t&&!this.#e,this.style_needs_nonce=this.#s&&!this.#e,this.#a=n}add_script(t){this.#t&&(this.#e?this.#r.push(`sha256-${_e(t)}`):this.#r.length===0&&this.#r.push(`nonce-${this.#a}`))}add_style(t){this.#s&&(this.#e?this.#n.push(`sha256-${_e(t)}`):this.#n.length===0&&this.#n.push(`nonce-${this.#a}`))}get_header(t=!1){const r=[],n={...this.#o};this.#n.length>0&&(n["style-src"]=[...n["style-src"]||n["default-src"]||[],...this.#n]),this.#r.length>0&&(n["script-src"]=[...n["script-src"]||n["default-src"]||[],...this.#r]);for(const s in n){if(t&&(s==="frame-ancestors"||s==="report-uri"||s==="sandbox"))continue;const o=n[s];if(!o)continue;const a=[s];Array.isArray(o)&&o.forEach(i=>{St.has(i)||Ot.test(i)?a.push(`'${i}'`):a.push(i)}),r.push(a.join(" "))}return r.join("; ")}}class qt extends Je{get_meta(){return`<meta http-equiv="content-security-policy" content=${He(this.get_header(!0))}>`}}class Pt extends Je{constructor(t,r,n){if(super(t,r,n),Object.values(r).filter(s=>!!s).length>0){const s=r["report-to"]?.length??0>0,o=r["report-uri"]?.length??0>0;if(!s&&!o)throw Error("`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both")}}}class At{nonce=vt();csp_provider;report_only_provider;constructor({mode:t,directives:r,reportOnly:n},{prerender:s}){const o=t==="hash"||t==="auto"&&s;this.csp_provider=new qt(o,r,this.nonce),this.report_only_provider=new Pt(o,n,this.nonce)}get script_needs_nonce(){return this.csp_provider.script_needs_nonce||this.report_only_provider.script_needs_nonce}get style_needs_nonce(){return this.csp_provider.style_needs_nonce||this.report_only_provider.style_needs_nonce}add_script(t){this.csp_provider.add_script(t),this.report_only_provider.add_script(t)}add_style(t){this.csp_provider.add_style(t),this.report_only_provider.add_style(t)}}const Tt={...Xe(!1),check:()=>!1};async function W({branch:e,fetched:t,options:r,manifest:n,state:s,page_config:o,status:a,error:i=null,event:c,resolve_opts:p,action_result:l}){if(s.prerendering){if(r.csp.mode==="nonce")throw new Error('Cannot use prerendering if config.kit.csp.mode === "nonce"');if(r.app_template_contains_nonce)throw new Error("Cannot use prerendering if page template contains %sveltekit.nonce%")}const{entry:_}=n._,b=new Set(_.stylesheets),u=new Set(_.imports),m=new Set(n._.entry.fonts),g=new Set,f=new Map;let d;const w=l?.type==="success"||l?.type==="failure"?l.data??null:null;if(o.ssr){const y={stores:{page:ie(null),navigating:ie(null),updated:Tt},constructors:await Promise.all(e.map(({node:R})=>R.component())),form:w};let x={};for(let R=0;R<e.length;R+=1)x={...x,...e[R].data},y[`data_${R}`]=x;y.page={error:i,params:c.params,route:c.route,status:a,url:c.url,data:x,form:w},d=r.root.render(y);for(const{node:R}of e)R.imports&&R.imports.forEach(S=>u.add(S)),R.stylesheets&&R.stylesheets.forEach(S=>b.add(S)),R.fonts&&R.fonts.forEach(S=>m.add(S)),R.inline_styles&&Object.entries(await R.inline_styles()).forEach(([S,I])=>f.set(S,I))}else d={head:"",html:"",css:{code:"",map:null}};let j="",h=d.html;const k=new At(r.csp,{prerender:!!s.prerendering}),E=X(h);let $;if(G)$=G;else if(s.prerendering?.fallback)$=F;else{const y=c.url.pathname.slice(F.length).split("/").slice(2);$=y.length>0?y.map(()=>"..").join("/"):"."}const v=y=>y.startsWith("/")?F+y:`${$}/${y}`,O={data:"",form:"null",error:"null"};try{O.data=`[${e.map(({server_data:y})=>{if(y?.type==="data"){const x=D.uneval(y.data),R=[];return y.uses.dependencies.size>0&&R.push(`dependencies:${A(Array.from(y.uses.dependencies))}`),y.uses.params.size>0&&R.push(`params:${A(Array.from(y.uses.params))}`),y.uses.parent&&R.push("parent:1"),y.uses.route&&R.push("route:1"),y.uses.url&&R.push("url:1"),`{type:"data",data:${x},uses:{${R.join(",")}}${y.slash?`,slash:${A(y.slash)}`:""}}`}return A(y)}).join(",")}]`}catch(y){const x=y;throw new Error(Se(c,x))}if(w&&(O.form=yt(w,c.route.id)),i&&(O.error=D.uneval(i)),f.size>0){const y=Array.from(f.values()).join(`
`),x=[];k.style_needs_nonce&&x.push(` nonce="${k.nonce}"`),k.add_style(y),j+=`
	<style${x.join("")}>${y}</style>`}for(const y of b){const x=v(y);if(p.preload({type:"css",path:x})){const R=['rel="stylesheet"'];if(f.has(y))R.push("disabled",'media="(max-width: 0)"');else{const S=['rel="preload"','as="style"'];g.add(`<${encodeURI(x)}>; ${S.join(";")}; nopush`)}j+=`
		<link href="${x}" ${R.join(" ")}>`}}for(const y of m){const x=v(y);if(p.preload({type:"font",path:x})){const S=['rel="preload"','as="font"',`type="font/${y.slice(y.lastIndexOf(".")+1)}"`,`href="${x}"`,"crossorigin"];j+=`
		<link ${S.join(" ")}>`}}if(o.csr){const y=[`assets: ${A(G)}`,`env: ${A(ce)}`,`target: document.querySelector('[data-sveltekit-hydrate="${E}"]').parentNode`,`version: ${A(Ke)}`];if(o.ssr){const S=[`node_ids: [${e.map(({node:I})=>I.index).join(", ")}]`,`data: ${O.data}`,`form: ${O.form}`,`error: ${O.error}`];a!==200&&S.push(`status: ${a}`),r.embedded&&S.push(`params: ${D.uneval(c.params)}`,`route: ${A(c.route)}`),y.push(`hydrate: {
					${S.join(`,
					`)}
				}`)}const x=`
			import { start } from ${A(v(_.file))};

			start({
				${y.join(`,
				`)}
			});
		`;for(const S of u){const I=v(S);p.preload({type:"js",path:I})&&(g.add(`<${encodeURI(I)}>; rel="modulepreload"; nopush`),s.prerendering&&(j+=`
		<link rel="modulepreload" href="${I}">`))}const R=['type="module"',`data-sveltekit-hydrate="${E}"`];k.add_script(x),k.script_needs_nonce&&R.push(`nonce="${k.nonce}"`),h+=`
		<script ${R.join(" ")}>${x}<\/script>`}if(o.ssr&&o.csr&&(h+=`
	${t.map(y=>jt(y,p.filterSerializedResponseHeaders,!!s.prerendering)).join(`
	`)}`),r.service_worker){const y="",x=`
			if ('serviceWorker' in navigator) {
				addEventListener('load', function () {
					navigator.serviceWorker.register('${v("service-worker.js")}'${y});
				});
			}
		`;k.add_script(x),j+=`
		<script${k.script_needs_nonce?` nonce="${k.nonce}"`:""}>${x}<\/script>`}if(s.prerendering){const y=[],x=k.csp_provider.get_meta();x&&y.push(x),s.prerendering.cache&&y.push(`<meta http-equiv="cache-control" content="${s.prerendering.cache}">`),y.length>0&&(j=y.join(`
`)+j)}j+=d.head;const z=r.templates.app({head:j,body:h,assets:$,nonce:k.nonce,env:ce}),J=await p.transformPageChunk({html:z,done:!0})||"",U=new Headers({"x-sveltekit-page":"true","content-type":"text/html",etag:`"${X(J)}"`});if(!s.prerendering){const y=k.csp_provider.get_header();y&&U.set("content-security-policy",y);const x=k.report_only_provider.get_header();x&&U.set("content-security-policy-report-only",x),g.size&&U.set("link",Array.from(g).join(", "))}return P(J,{status:a,headers:U})}function q(e,t){return e.reduce((r,n)=>n?.universal?.[t]??n?.server?.[t]??r,void 0)}async function Ge({event:e,options:t,manifest:r,state:n,status:s,error:o,resolve_opts:a}){const i=[];try{const c=[],p=await r._.nodes[0](),l=q([p],"ssr")??!0,_=q([p],"csr")??!0;if(l){n.initiator=ve;const b=oe({event:e,state:n,node:p,parent:async()=>({})}),u=await b,m=await Ue({event:e,fetched:i,node:p,parent:async()=>({}),resolve_opts:a,server_data_promise:b,state:n,csr:_});c.push({node:p,server_data:u,data:m},{node:await r._.nodes[1](),data:null,server_data:null})}return await W({options:t,manifest:r,state:n,page_config:{ssr:l,csr:q([p],"csr")??!0},status:s,error:await H(e,t,o),branch:c,fetched:i,event:e,resolve_opts:a})}catch(c){return c instanceof C?B(c.status,c.location):re(t,c instanceof N?c.status:500,(await H(e,t,c)).message)}}async function Ct(e,t,r,n,s,o,a){if(o.initiator===t)return P(`Not found: ${e.url.pathname}`,{status:404});if(o.initiator=t,pt(e)){const i=await s._.nodes[r.leaf]();return ht(e,n,i?.server)}try{const i=await Promise.all([...r.layouts.map(h=>h==null?h:s._.nodes[h]()),s._.nodes[r.leaf]()]),c=i.at(-1);let p=200,l;if(_t(e)){if(l=await mt(e,c.server),l?.type==="redirect")return B(l.status,l.location);if(l?.type==="error"){const h=l.error;p=h instanceof N?h.status:500}l?.type==="failure"&&(p=l.status)}const _=i.some(h=>h?.server),b=ft(e.url.pathname),u=q(i,"prerender");if(u){if(c.server?.actions)throw new Error("Cannot prerender pages with actions")}else if(o.prerendering)return u!==!1&&q(i,"ssr")===!1&&!c.server?.actions?await W({branch:[],fetched:[],page_config:{ssr:!1,csr:q(i,"csr")??!0},status:p,error:null,event:e,options:n,manifest:s,state:o,resolve_opts:a}):new Response(void 0,{status:204});o.prerender_default=u;const m=[];if(q(i,"ssr")===!1)return await W({branch:[],fetched:m,page_config:{ssr:!1,csr:q(i,"csr")??!0},status:p,error:null,event:e,options:n,manifest:s,state:o,resolve_opts:a});let g=[],f=null;const d=i.map((h,k)=>{if(f)throw f;return Promise.resolve().then(async()=>{try{if(h===c&&l?.type==="error")throw l.error;return await oe({event:e,state:o,node:h,parent:async()=>{const E={};for(let $=0;$<k;$+=1){const v=await d[$];v&&Object.assign(E,await v.data)}return E}})}catch(E){throw f=E,f}})}),w=q(i,"csr")??!0,j=i.map((h,k)=>{if(f)throw f;return Promise.resolve().then(async()=>{try{return await Ue({event:e,fetched:m,node:h,parent:async()=>{const E={};for(let $=0;$<k;$+=1)Object.assign(E,await j[$]);return E},resolve_opts:a,server_data_promise:d[k],state:o,csr:w})}catch(E){throw f=E,f}})});for(const h of d)h.catch(()=>{});for(const h of j)h.catch(()=>{});for(let h=0;h<i.length;h+=1){const k=i[h];if(k)try{const E=await d[h],$=await j[h];g.push({node:k,server_data:E,data:$})}catch(E){const $=E;if($ instanceof C){if(o.prerendering&&_){const z=JSON.stringify({type:"redirect",location:$.location});o.prerendering.dependencies.set(b,{response:P(z),body:z})}return B($.status,$.location)}const v=$ instanceof N?$.status:500,O=await H(e,n,$);for(;h--;)if(r.errors[h]){const z=r.errors[h],J=await s._.nodes[z]();let U=h;for(;!g[U];)U-=1;return await W({event:e,options:n,manifest:s,state:o,resolve_opts:a,page_config:{ssr:!0,csr:!0},status:v,error:O,branch:fe(g.slice(0,U+1)).concat({node:J,data:null,server_data:null}),fetched:m})}return re(n,v,O.message)}else g.push(null)}if(o.prerendering&&_){const h=`{"type":"data","nodes":[${g.map(k=>Oe(k?.server_data)).join(",")}]}`;o.prerendering.dependencies.set(b,{response:P(h),body:h})}return await W({event:e,options:n,manifest:s,state:o,resolve_opts:a,page_config:{csr:q(i,"csr")??!0,ssr:!0},status:p,error:null,branch:fe(g),action_result:l,fetched:m})}catch(i){return await Ge({event:e,options:n,manifest:s,state:o,status:500,error:i,resolve_opts:a})}}function zt(e,t,r){const n={},s=e.slice(1);let o=0;for(let a=0;a<t.length;a+=1){const i=t[a],c=s[a-o];if(i.chained&&i.rest&&o){n[i.name]=s.slice(a-o,a+1).filter(p=>p).join("/"),o=0;continue}if(c===void 0){i.rest&&(n[i.name]="");continue}if(!i.matcher||r[i.matcher](c)){n[i.name]=c;continue}if(i.optional&&i.chained){o++;continue}return}if(!o)return n}function Ut(e){let t=!1,r;return()=>t?r:(t=!0,r=e())}const ye="x-sveltekit-invalidated";async function Nt(e,t,r,n,s,o,a){if(!t.page)return new Response(void 0,{status:404});s.initiator=t;try{const i=[...t.page.layouts,t.page.leaf],c=o??i.map(()=>!0);let p=!1;const l=new URL(e.url);l.pathname=ne(l.pathname,a);const _={...e,url:l},b=i.map((f,d)=>Ut(async()=>{try{if(p)return{type:"skip"};const w=f==null?f:await n._.nodes[f]();return oe({event:_,state:s,node:w,parent:async()=>{const j={};for(let h=0;h<d;h+=1){const k=await b[h]();k&&Object.assign(j,k.data)}return j}})}catch(w){throw p=!0,w}})),u=b.map(async(f,d)=>c[d]?f():{type:"skip"});let m=u.length;const g=await Promise.all(u.map((f,d)=>f.catch(async w=>{if(w instanceof C)throw w;return m=Math.min(m,d+1),{type:"error",error:await H(e,r,w),status:w instanceof N?w.status:void 0}})));try{const d=`{"type":"data","nodes":[${g.slice(0,m).map(Oe).join(",")}]}`;return M(d)}catch(f){return M(JSON.stringify(Se(e,f)),500)}}catch(i){const c=i;return c instanceof C?Q(c):M(JSON.stringify(await H(e,r,c)))}}function M(e,t=200){return P(e,{status:t,headers:{"content-type":"application/json","cache-control":"private, no-store"}})}function Q(e){return M(JSON.stringify({type:"redirect",location:e.location}))}function Ht(e,t,r){const n=e.headers.get("cookie")??"",s=V(n,{decode:_=>_}),a=ne(t.pathname,r).split("/").slice(0,-1).join("/")||"/",i={},c={httpOnly:!0,sameSite:"lax",secure:!(t.hostname==="localhost"&&t.protocol==="http:")},p={get(_,b){const u=i[_];if(u&&ge(t.hostname,u.options.domain)&&we(t.pathname,u.options.path))return u.value;const m=b?.decode||decodeURIComponent;return V(n,{decode:m})[_]},set(_,b,u={}){let m=u.path??a;i[_]={name:_,value:b,options:{...c,...u,path:m}}},delete(_,b={}){p.set(_,"",{...b,maxAge:0})},serialize(_,b,u){return xe(_,b,{...c,...u})}};function l(_,b){const u={...s};for(const m in i){const g=i[m];if(!ge(_.hostname,g.options.domain)||!we(_.pathname,g.options.path))continue;const f=g.options.encode||encodeURIComponent;u[g.name]=f(g.value)}if(b){const m=V(b,{decode:g=>g});for(const g in m)u[g]=m[g]}return Object.entries(u).map(([m,g])=>`${m}=${g}`).join("; ")}return{cookies:p,new_cookies:i,get_cookie_header:l}}function ge(e,t){if(!t)return!0;const r=t[0]==="."?t.slice(1):t;return e===r?!0:e.endsWith("."+r)}function we(e,t){if(!t)return!0;const r=t.endsWith("/")?t.slice(0,-1):t;return e===r?!0:e.startsWith(r+"/")}function $e(e,t){for(const r of t){const{name:n,value:s,options:o}=r;e.append("set-cookie",xe(n,s,o))}}function It({event:e,options:t,manifest:r,state:n,get_cookie_header:s}){return async(o,a)=>{const i=be(o,a,e.url),c=a?.body;let p=(o instanceof Request?o.mode:a?.mode)??"cors",l=(o instanceof Request?o.credentials:a?.credentials)??"same-origin";return await t.hooks.handleFetch({event:e,request:i,fetch:async(_,b)=>{const u=be(_,b,e.url),m=new URL(u.url);if(u.headers.has("origin")||u.headers.set("origin",e.url.origin),_!==i&&(p=(_ instanceof Request?_.mode:b?.mode)??"cors",l=(_ instanceof Request?_.credentials:b?.credentials)??"same-origin"),(u.method==="GET"||u.method==="HEAD")&&(p==="no-cors"&&m.origin!==e.url.origin||m.origin===e.url.origin)&&u.headers.delete("origin"),m.origin!==e.url.origin){if(`.${m.hostname}`.endsWith(`.${e.url.hostname}`)&&l!=="omit"){const $=s(m,u.headers.get("cookie"));$&&u.headers.set("cookie",$)}return fetch(u)}let g;const f=G||F,d=decodeURIComponent(m.pathname),w=(d.startsWith(f)?d.slice(f.length):d).slice(1),j=`${w}/index.html`,h=r.assets.has(w),k=r.assets.has(j);if(h||k){const $=h?w:j;if(n.read){const v=h?r.mimeTypes[w.slice(w.lastIndexOf("."))]:"text/html";return new Response(n.read($),{headers:v?{"content-type":v}:{}})}return await fetch(u)}if(l!=="omit"){const $=s(m,u.headers.get("cookie"));$&&u.headers.set("cookie",$);const v=e.request.headers.get("authorization");v&&!u.headers.has("authorization")&&u.headers.set("authorization",v)}if(c&&typeof c!="string"&&!ArrayBuffer.isView(c))throw new Error("Request body must be a string or TypedArray");u.headers.has("accept")||u.headers.set("accept","*/*"),u.headers.has("accept-language")||u.headers.set("accept-language",e.request.headers.get("accept-language")),g=await Ve(u,t,r,n);const E=g.headers.get("set-cookie");if(E)for(const $ of ue.splitCookiesString(E)){const{name:v,value:O,...z}=ue.parseString($);e.cookies.set(v,O,z)}return g}})}}function be(e,t,r){return e instanceof Request?e:new Request(typeof e=="string"?new URL(e,r):e,t)}function ae(e){const t=new Set(e);function r(n,s){if(n)for(const o in n){if(o[0]==="_"||t.has(o))continue;const a=Wt(o,s?.slice(s.lastIndexOf(".")))??`valid exports are ${e.join(", ")}, or anything with a '_' prefix`;throw new Error(`Invalid export '${o}'${s?` in ${s}`:""} (${a})`)}}return r}function Wt(e,t=".js"){let r=[];if(Fe.includes(e)&&r.push(`+page${t}`),Me.includes(e)&&r.push(`+page.server${t}`),Be.includes(e)&&r.push(`+server${t}`),r.length>0)return`'${e}' is a valid export in ${r.join(" or ")}`}const Fe=["load","prerender","csr","ssr","trailingSlash","config"],Me=["load","prerender","csr","ssr","actions","trailingSlash","config"],Be=["GET","POST","PATCH","PUT","DELETE","OPTIONS","prerender","trailingSlash","config"],Ft=ae(Fe),Mt=ae(Me),Bt=ae(Be),ke=({html:e})=>e,je=()=>!1,Ee=({type:e})=>e==="js"||e==="css";async function Ve(e,t,r,n){let s=new URL(e.url);if(t.csrf_check_origin&&e.method==="POST"&&e.headers.get("origin")!==s.origin&&Re(e)){const d=Z(403,`Cross-site ${e.method} form submissions are forbidden`);return e.headers.get("accept")==="application/json"?Y(d.body,{status:d.status}):P(d.body.message,{status:d.status})}let o;try{o=at(s.pathname)}catch{return P("Malformed URI",{status:400})}let a=null,i={};const c=dt(o);let p;if(c&&(o=pe(o)||"/",s.pathname=pe(s.pathname)||"/",p=s.searchParams.get(ye)?.split("_").map(Boolean),s.searchParams.delete(ye)),!n.prerendering?.fallback){const f=await r._.matchers();for(const d of r._.routes){const w=d.pattern.exec(o);if(!w)continue;const j=zt(w,d.params,f);if(j){a=d,i=it(j);break}}}let l;const _={};let b={};const u={cookies:null,fetch:null,getClientAddress:n.getClientAddress||(()=>{throw new Error("@sveltejs/adapter-vercel does not specify getClientAddress. Please raise an issue")}),locals:{},params:i,platform:n.platform,request:e,route:{id:a?.id??null},setHeaders:f=>{for(const d in f){const w=d.toLowerCase(),j=f[d];if(w==="set-cookie")throw new Error("Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies");if(w in _)throw new Error(`"${d}" header is already set`);_[w]=j,n.prerendering&&w==="cache-control"&&(n.prerendering.cache=j)}},url:s,isDataRequest:c};let m={transformPageChunk:ke,filterSerializedResponseHeaders:je,preload:Ee};try{if(a&&!c){if(a.page){const k=await Promise.all([...a.page.layouts.map(E=>E==null?E:r._.nodes[E]()),r._.nodes[a.page.leaf]()]);l=q(k,"trailingSlash")}else a.endpoint&&(l=(await a.endpoint()).trailingSlash);const h=ne(s.pathname,l??"never");if(h!==s.pathname&&!n.prerendering?.fallback)return new Response(void 0,{status:301,headers:{"x-sveltekit-normalize":"1",location:(h.startsWith("//")?s.origin+h:h)+(s.search==="?"?"":s.search)}})}const{cookies:f,new_cookies:d,get_cookie_header:w}=Ht(e,s,l??"never");b=d,u.cookies=f,u.fetch=It({event:u,options:t,manifest:r,state:n,get_cookie_header:w}),n.prerendering&&!n.prerendering.fallback&&qe(s);const j=await t.hooks.handle({event:u,resolve:(h,k)=>g(h,k).then(E=>{for(const $ in _){const v=_[$];E.headers.set($,v)}return $e(E.headers,Object.values(b)),n.prerendering&&h.route.id!==null&&E.headers.set("x-sveltekit-routeid",encodeURI(h.route.id)),E})});if(j.status===200&&j.headers.has("etag")){let h=e.headers.get("if-none-match");h?.startsWith('W/"')&&(h=h.substring(2));const k=j.headers.get("etag");if(h===k){const E=new Headers({etag:k});for(const $ of["cache-control","content-location","date","expires","vary","set-cookie"]){const v=j.headers.get($);v&&E.set($,v)}return new Response(void 0,{status:304,headers:E})}}if(c&&j.status>=300&&j.status<=308){const h=j.headers.get("location");if(h)return Q(new C(j.status,h))}return j}catch(f){if(f instanceof C){const d=c?Q(f):B(f.status,f.location);return $e(d.headers,Object.values(b)),d}return await de(u,t,f)}async function g(f,d){try{if(d){if("ssr"in d)throw new Error("ssr has been removed, set it in the appropriate +layout.js instead. See the PR for more information: https://github.com/sveltejs/kit/pull/6197");m={transformPageChunk:d.transformPageChunk||ke,filterSerializedResponseHeaders:d.filterSerializedResponseHeaders||je,preload:d.preload||Ee}}if(n.prerendering?.fallback)return await W({event:f,options:t,manifest:r,state:n,page_config:{ssr:!1,csr:!0},status:200,error:null,branch:[],fetched:[],resolve_opts:m});if(a){let w;if(c)w=await Nt(f,a,t,r,n,p,l??"never");else if(a.endpoint&&(!a.page||ot(f)))w=await st(f,a,await a.endpoint(),n);else if(a.page)w=await Ct(f,a,a.page,t,r,n,m);else throw new Error("This should never happen");return w}return n.initiator===ve?P("Internal Server Error",{status:500}):n.initiator?n.prerendering?P("not found",{status:404}):await fetch(e):await Ge({event:f,options:t,manifest:r,state:n,status:404,error:new Error(`Not found: ${f.url.pathname}`),resolve_opts:m})}catch(w){return await de(f,t,w)}finally{f.cookies.set=()=>{throw new Error("Cannot use `cookies.set(...)` after the response has been generated")},f.setHeaders=()=>{throw new Error("Cannot use `setHeaders(...)` after the response has been generated")}}}}class Vt{#e;#t;constructor(t){this.#e=Qe,this.#t=t}async init({env:t}){const r=Object.entries(t),n=this.#e.env_public_prefix;Object.fromEntries(r.filter(([o])=>!o.startsWith(n)));const s=Object.fromEntries(r.filter(([o])=>o.startsWith(n)));if(Ze(s),!this.#e.hooks){const o=await Ye();this.#e.hooks={handle:o.handle||(({event:a,resolve:i})=>i(a)),handleError:o.handleError||(({error:a})=>console.error(a?.stack)),handleFetch:o.handleFetch||(({request:a,fetch:i})=>i(a))}}}async respond(t,r){if(!(t instanceof Request))throw new Error("The first argument to server.respond must be a Request object. See https://github.com/sveltejs/kit/pull/3384 for details");return Ve(t,this.#e,this.#t,r)}}export{Vt as Server};
